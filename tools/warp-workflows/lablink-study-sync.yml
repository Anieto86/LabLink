# LabLink Study Sync Workflow
# Warp workflow para sincronizar LabLink con Obsidian para estudios

name: LabLink Study Sync
description: Sincroniza automÃ¡ticamente LabLink con Obsidian para sesiones de estudio
tags: [lablink, obsidian, sync, study]

# ConfiguraciÃ³n de rutas
LABLINK_PROJECT="/c/Users/alvar/Documents/LabLink-node"
OBSIDIAN_VAULT="/c/Users/alvar/Documents/Obsidian-syc-git/Projects/LabLink"

# Comando principal de sincronizaciÃ³n
sync_all:
  command: |
    echo "ðŸ”„ Iniciando sincronizaciÃ³n LabLink â†’ Obsidian..."

    # Navegar al proyecto
    cd "$LABLINK_PROJECT"

    # Verificar que estamos en el directorio correcto
    if [ ! -f "package.json" ]; then
        echo "âŒ Error: No estamos en el directorio de LabLink"
        exit 1
    fi

    # Obtener Ãºltimos cambios del repositorio
    echo "ðŸ“¥ Obteniendo Ãºltimos cambios..."
    git fetch origin
    git pull origin main

    # Ejecutar script de sincronizaciÃ³n
    echo "ðŸ”„ Sincronizando archivos..."
    bash scripts/auto-sync-to-obsidian.sh

    # Verificar que Obsidian tiene los archivos
    if [ -d "$OBSIDIAN_VAULT/src" ] && [ -d "$OBSIDIAN_VAULT/docs" ]; then
        echo "âœ… SincronizaciÃ³n completada exitosamente!"
        echo "ðŸ“ Archivos disponibles en: $OBSIDIAN_VAULT"
        echo "ðŸŽ¯ Listo para estudiar en Obsidian!"
    else
        echo "âŒ Error en la sincronizaciÃ³n"
        exit 1
    fi

# SincronizaciÃ³n rÃ¡pida (solo archivos modificados)
quick_sync:
  command: |
    echo "âš¡ SincronizaciÃ³n rÃ¡pida..."
    cd "$LABLINK_PROJECT"

    # Solo sincronizar si hay cambios
    if [ -n "$(git status --porcelain)" ]; then
        echo "ðŸ“ Cambios detectados, sincronizando..."
        bash scripts/auto-sync-to-obsidian.sh
    else
        echo "âœ… No hay cambios para sincronizar"
    fi

# Iniciar sesiÃ³n de estudio
start_study:
  command: |
    echo "ðŸ“š Iniciando sesiÃ³n de estudio LabLink..."

    # Sincronizar primero
    cd "$LABLINK_PROJECT"
    bash scripts/auto-sync-to-obsidian.sh

    # Abrir Obsidian (si estÃ¡ instalado)
    if command -v obsidian &> /dev/null; then
        echo "ðŸ”“ Abriendo Obsidian..."
        obsidian "$OBSIDIAN_VAULT"
    else
        echo "ðŸ“ Obsidian vault listo en: $OBSIDIAN_VAULT"
    fi

    # Mostrar estado del proyecto
    echo "ðŸ“Š Estado del proyecto:"
    echo "  ðŸ“ Source files: $(find src -name '*.ts' | wc -l) archivos TypeScript"
    echo "  ðŸ“– Documentation: $(find docs -name '*.md' | wc -l) archivos Markdown"
    echo "  ðŸ“ Last commit: $(git log -1 --pretty=format:'%h - %s (%cr)')"

# Limpiar y resetear sincronizaciÃ³n
reset_sync:
  command: |
    echo "ðŸ§¹ Limpiando y reseteando sincronizaciÃ³n..."

    # Limpiar directorio de Obsidian
    if [ -d "$OBSIDIAN_VAULT" ]; then
        echo "ðŸ—‘ï¸ Limpiando directorio de Obsidian..."
        rm -rf "$OBSIDIAN_VAULT/src" "$OBSIDIAN_VAULT/docs"
        rm -f "$OBSIDIAN_VAULT/package.json" "$OBSIDIAN_VAULT/Project-README.md"
    fi

    # SincronizaciÃ³n completa
    cd "$LABLINK_PROJECT"
    bash scripts/auto-sync-to-obsidian.sh

    echo "âœ… Reset completado!"

# Verificar estado de sincronizaciÃ³n
check_sync:
  command: |
    echo "ðŸ” Verificando estado de sincronizaciÃ³n..."

    cd "$LABLINK_PROJECT"

    # Verificar Ãºltima modificaciÃ³n en LabLink
    LABLINK_LAST=$(find src docs -type f -exec stat -c %Y {} \; | sort -n | tail -1)

    # Verificar Ãºltima modificaciÃ³n en Obsidian
    if [ -d "$OBSIDIAN_VAULT/src" ]; then
        OBSIDIAN_LAST=$(find "$OBSIDIAN_VAULT/src" "$OBSIDIAN_VAULT/docs" -type f -exec stat -c %Y {} \; 2>/dev/null | sort -n | tail -1)
    else
        OBSIDIAN_LAST=0
    fi

    echo "ðŸ“Š Estado de sincronizaciÃ³n:"
    echo "  ðŸ  LabLink Ãºltimo cambio: $(date -d @$LABLINK_LAST '+%Y-%m-%d %H:%M:%S')"
    echo "  ðŸ§  Obsidian Ãºltimo sync: $(date -d @$OBSIDIAN_LAST '+%Y-%m-%d %H:%M:%S')"

    if [ $LABLINK_LAST -gt $OBSIDIAN_LAST ]; then
        echo "  âš ï¸ Obsidian necesita actualizaciÃ³n"
        echo "  ðŸ’¡ Ejecuta: warp run sync_all"
    else
        echo "  âœ… Obsidian estÃ¡ actualizado"
    fi

# Mostrar estadÃ­sticas del proyecto
stats:
  command: |
    cd "$LABLINK_PROJECT"

    echo "ðŸ“Š EstadÃ­sticas de LabLink:"
    echo ""
    echo "ðŸ“ Estructura del proyecto:"
    echo "  TypeScript files: $(find src -name '*.ts' | wc -l)"
    echo "  JavaScript files: $(find src -name '*.js' | wc -l)"
    echo "  Test files: $(find . -name '*.test.*' | wc -l)"
    echo "  Documentation: $(find docs -name '*.md' | wc -l)"
    echo ""
    echo "ðŸ“ˆ Git stats:"
    echo "  Total commits: $(git rev-list --all --count)"
    echo "  Contributors: $(git shortlog -sn | wc -l)"
    echo "  Last commit: $(git log -1 --pretty=format:'%h - %s (%cr)')"
    echo ""
    echo "ðŸ“¦ Dependencies:"
    echo "  Production: $(cat package.json | jq '.dependencies | length')"
    echo "  Development: $(cat package.json | jq '.devDependencies | length')"

# Workflow completo de estudio
full_study_workflow:
  command: |
    echo "ðŸŽ“ Iniciando workflow completo de estudio LabLink..."

    # 1. Sincronizar todo
    echo "ðŸ”„ Paso 1: SincronizaciÃ³n..."
    cd "$LABLINK_PROJECT"
    git pull origin main
    bash scripts/auto-sync-to-obsidian.sh

    # 2. Mostrar estadÃ­sticas
    echo ""
    echo "ðŸ“Š Paso 2: Estado del proyecto..."
    echo "  ðŸ“ Commits hoy: $(git log --since='today' --oneline | wc -l)"
    echo "  ðŸ“ Archivos modificados: $(git status --porcelain | wc -l)"
    echo "  ðŸ·ï¸ Ãšltima versiÃ³n: $(git describe --tags --abbrev=0 2>/dev/null || echo 'No tags')"

    # 3. Preparar sesiÃ³n de estudio
    echo ""
    echo "ðŸŽ¯ Paso 3: Preparando sesiÃ³n de estudio..."

    # Crear nota de sesiÃ³n automÃ¡tica
    SESSION_DATE=$(date '+%Y-%m-%d')
    SESSION_FILE="$OBSIDIAN_VAULT/Session Notes/Study Session $SESSION_DATE.md"

    if [ ! -f "$SESSION_FILE" ]; then
        cat > "$SESSION_FILE" << EOF
---
tags: [lablink, study-session, $(date '+%Y-%m-%d')]
created: $(date '+%Y-%m-%d %H:%M:%S')
type: study-session
---

# ðŸ“š LabLink Study Session - $SESSION_DATE

## ðŸŽ¯ Today's Goals
- [ ]
- [ ]
- [ ]

## ðŸ“Š Project Status
- **Last Commit**: $(git log -1 --pretty=format:'%h - %s (%cr)')
- **Files Synced**: $(date '+%H:%M:%S')
- **Study Start**: $(date '+%H:%M:%S')

## ðŸ” Focus Areas
- [ ] Architecture analysis
- [ ] Code flow tracing
- [ ] Database schema study
- [ ] API endpoint testing

## ðŸ“ Notes


## ðŸŽ¯ Next Session
- [ ]
- [ ]

EOF
        echo "ðŸ“ Nota de sesiÃ³n creada: $SESSION_FILE"
    fi

    echo ""
    echo "âœ… Workflow completo listo!"
    echo "ðŸŽ¯ Siguiente paso: Abrir Obsidian y comenzar a estudiar"
    echo "ðŸ“ Vault: $OBSIDIAN_VAULT"
